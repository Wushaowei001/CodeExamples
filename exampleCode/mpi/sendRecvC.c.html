<!DOCTYPE html PUBLIC "-//IETF//DTD HTML 2.0//EN">
<HTML>
<HEAD>
<TITLE>mpi/sendRecvC.c</TITLE>
</HEAD>
<BODY BGCOLOR="#FFFFFF" TEXT="#000000" LINK="#1F00FF" ALINK="#FF0000" VLINK="#9900DD">
<A NAME="top"> </A>
<A NAME="file1"> </A>
<H1><a href="sendRecvC.c">sendRecvC.c</a></H1>

<PRE>
<I><FONT COLOR="#B22222">/**
   @file      sendRecvC.c
   @author    Mitch Richling &lt;http://www.mitchr.me/&gt;
   @Copyright Copyright 1999 by Mitch Richling.  All rights reserved.
   @brief     Demo MPI functions MPI_Send and MPI_Recv@EOL
   @Keywords  LAM MPI
   @Std       C99 MPI1

              This program demonstrates the following functions:

                    MPI_Send
                    MPI_Recv

              Note that this program makes the same mistake that many
              real world MPI programs do.  It makes the assumption
              that no process will die and that all will end up
              sending back the part of the computation they were
              responsible for. In this program, if that doesn't
              happen, then the rank 0 process will wait forever for a
              communication that may never come.  See sendRecvErrC.c
              for a way out of this situation.

              This code requires that the rank zero process have
              stdout capabilities -- which most MPI implementations
              provide.
*/</FONT></I>

#<B><FONT COLOR="#5F9EA0">include</FONT></B> <B><FONT COLOR="#BC8F8F">&lt;stdio.h&gt;</FONT></B>              <I><FONT COLOR="#B22222">/* I/O lib         ISOC  */</FONT></I>
#<B><FONT COLOR="#5F9EA0">include</FONT></B> <B><FONT COLOR="#BC8F8F">&lt;mpi.h&gt;</FONT></B>                <I><FONT COLOR="#B22222">/* MPI Std         MPI   */</FONT></I>

<B><FONT COLOR="#228B22">int</FONT></B> <B><FONT COLOR="#0000FF">main</FONT></B>(<B><FONT COLOR="#228B22">int</FONT></B> argc, <B><FONT COLOR="#228B22">char</FONT></B> *argv[]) {
  <B><FONT COLOR="#228B22">int</FONT></B> rank, size, n, rslt, i, flags;
  MPI_Status status;
  <B><FONT COLOR="#228B22">int</FONT></B> needData, msgProbeCount=0;

  MPI_Init(&amp;argc, &amp;argv);

  MPI_Comm_rank(MPI_COMM_WORLD, &amp;rank);
  MPI_Comm_size(MPI_COMM_WORLD, &amp;size);

  <B><FONT COLOR="#A020F0">if</FONT></B>(rank == 0) {
    printf(<B><FONT COLOR="#BC8F8F">&quot;Mr. Zero has come on line....\n&quot;</FONT></B>);
    printf(<B><FONT COLOR="#BC8F8F">&quot;Mr. Zero waiting for %d slaves to check in.\n&quot;</FONT></B>, size);

    <I><FONT COLOR="#B22222">/* NOTE: If a slave process were to die before sending it's
       results back, this loop would hang forever.  See sendRecvErrC.c
       for an example of how to recover in that situation.*/</FONT></I>
    <B><FONT COLOR="#A020F0">for</FONT></B>(i=1;i&lt;size;i++) {
      
      <I><FONT COLOR="#B22222">/* Receive a message. */</FONT></I>
      rslt = MPI_Recv(&amp;n, 1, MPI_INT, <I><FONT COLOR="#B22222">// Location of data, number of elements, type
</FONT></I>                      MPI_ANY_SOURCE, <I><FONT COLOR="#B22222">// Who to receive data from
</FONT></I>                      MPI_ANY_TAG,    <I><FONT COLOR="#B22222">// Tags to receive
</FONT></I>                      MPI_COMM_WORLD, <I><FONT COLOR="#B22222">// Group from which to receive
</FONT></I>                      &amp;status);       <I><FONT COLOR="#B22222">// Status of call
</FONT></I>      printf(<B><FONT COLOR="#BC8F8F">&quot;Process %d has checked in (%d,%d,%d,%d)\n&quot;</FONT></B>, 
             n, status.MPI_SOURCE, status.MPI_TAG, status.MPI_ERROR, rslt);
    } <I><FONT COLOR="#B22222">/* end for */</FONT></I>
  } <B><FONT COLOR="#A020F0">else</FONT></B> {
    <I><FONT COLOR="#B22222">/* Sleep a bit to help demonstrate the probe and wait code in the
       rank 0 process. */</FONT></I>
    sleep(rank/2+1);

    <I><FONT COLOR="#B22222">/* Send a message. MPI_Ssend(...) is the same thing, but it blocks
       until the receiver starts to read data. */</FONT></I>
    MPI_Send(&amp;rank, 1, MPI_INT, <I><FONT COLOR="#B22222">// The data, number of elements, and type
</FONT></I>             0,                 <I><FONT COLOR="#B22222">// Who to send data too
</FONT></I>             999,               <I><FONT COLOR="#B22222">// Tag to use (random number in this case)
</FONT></I>             MPI_COMM_WORLD);   <I><FONT COLOR="#B22222">// The group we are sending to.
</FONT></I>  } <I><FONT COLOR="#B22222">/* end if/else */</FONT></I>

  MPI_Finalize();
  <B><FONT COLOR="#A020F0">return</FONT></B> 0;
} <I><FONT COLOR="#B22222">/* end func main */</FONT></I>
</PRE>
<HR \/>
<ADDRESS>Generated by <A HREF="http://www.iki.fi/~mtr/genscript/">GNU Enscript 1.6.5.2</A>.</ADDRESS>
</BODY>
</HTML>
