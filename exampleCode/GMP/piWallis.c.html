<!DOCTYPE html PUBLIC "-//IETF//DTD HTML 2.0//EN">
<HTML>
<HEAD>
<TITLE>GMP/piWallis.c</TITLE>
</HEAD>
<BODY BGCOLOR="#FFFFFF" TEXT="#000000" LINK="#1F00FF" ALINK="#FF0000" VLINK="#9900DD">
<A NAME="top"> </A>
<A NAME="file1"> </A>
<H1><a href="piWallis.c">piWallis.c</a></H1>

<PRE>
<I><FONT COLOR="#B22222">/**
   @file      piWallis.c
   @author    Mitch Richling &lt;http://www.mitchr.me/&gt;
   @Copyright Copyright 1999 by Mitch Richling.  All rights reserved.
   @brief     Approximate Pi via a beautiful, but inefficient, formula.@EOL
   @Keywords  none
   @Std       C89

              This program computes pi, quite inefficiently, using a
              wonderful Wallis formula (Wells 1986).  This is a great
              example of a beautiful formula leading to a horribly
              inefficient algorithm. :) Still, the point is to
              demonstrate GMP, not good mathematical algorithm design.
              Take a look at gmp-chudnovsky.c at the GMP site (last
              known URL: http://www.swox.com/gmp/pi-with-gmp.html) for
              a much more robust way to compute pi to many digits.


              Our formula:

              $$ %% Begin TeX/LaTeX
              \frac{\pi}{4} = 
              \prod_{n=1}^\infty\left[\frac{(2n)^2}{(2n-1)(2n+1)}\right] = 
              \prod_{n=1}^\infty\left[\frac{4\cdot n^2}{4n^2-1}\right] = 
              \frac{1\cdot2}{1\cdot3}\frac{4\cdot4}{3\cdot5}\frac{6\cdot6}{5\cdot7}\cdots
              $$ %% End TeX/LaTeX
   
              Mathematica Notation
              In[1]:= 2*Product[4*n^2/(4*n^2 - 1), {n, 1, Infinity}]
              Out[1]= Pi
*/</FONT></I>

#<B><FONT COLOR="#5F9EA0">include</FONT></B> <B><FONT COLOR="#BC8F8F">&lt;stdlib.h&gt;</FONT></B>             <I><FONT COLOR="#B22222">/* Standard Lib    ISOC  */</FONT></I>
#<B><FONT COLOR="#5F9EA0">include</FONT></B> <B><FONT COLOR="#BC8F8F">&lt;stdarg.h&gt;</FONT></B>             <I><FONT COLOR="#B22222">/* Variable args   ISOC  */</FONT></I>
#<B><FONT COLOR="#5F9EA0">include</FONT></B> <B><FONT COLOR="#BC8F8F">&lt;stdio.h&gt;</FONT></B>              <I><FONT COLOR="#B22222">/* I/O lib         ISOC  */</FONT></I>
#<B><FONT COLOR="#5F9EA0">include</FONT></B> <B><FONT COLOR="#BC8F8F">&lt;gmp.h&gt;</FONT></B>                <I><FONT COLOR="#B22222">/* GNU GMP Library       */</FONT></I>

<B><FONT COLOR="#228B22">int</FONT></B> <B><FONT COLOR="#0000FF">main</FONT></B>(<B><FONT COLOR="#228B22">void</FONT></B>) {
  mpz_t t, b;
  mpf_t p, tf, bf;
  <B><FONT COLOR="#228B22">int</FONT></B> n;
  mpz_t n2, n2m1, n2p1;

  <I><FONT COLOR="#B22222">// Set up our floating point numbers
</FONT></I>   mpf_set_default_prec(1000);
   mpf_init(p);
   mpf_init(tf);
   mpf_init(bf);

  <I><FONT COLOR="#B22222">// Compute the top and bottom of the fraction
</FONT></I>  mpz_init_set_si(t,     1);
  mpz_init_set_si(b,     1);
  mpz_init_set_si(n2,    0);
  mpz_init_set_si(n2m1, -1);
  mpz_init_set_si(n2p1,  1);
  <B><FONT COLOR="#A020F0">for</FONT></B>(n=1; n&lt;1000; n++) {
    mpz_add_ui(n2,   n2,   2); <I><FONT COLOR="#B22222">// 2*n
</FONT></I>    mpz_add_ui(n2m1, n2m1, 2); <I><FONT COLOR="#B22222">// 2*n-1
</FONT></I>    mpz_add_ui(n2p1, n2p1, 2); <I><FONT COLOR="#B22222">// 2*n+1
</FONT></I>    mpz_mul(t, t, n2);
    mpz_mul(t, t, n2);
    mpz_mul(b, b, n2m1);
    mpz_mul(b, b, n2p1);
  } <I><FONT COLOR="#B22222">/* end for */</FONT></I>

  <I><FONT COLOR="#B22222">// Compute the fraction value
</FONT></I>   mpz_mul_ui(t, t, 2);
   mpf_set_z(tf, t);
   mpf_set_z(bf, b);
   mpf_div(p, tf, bf);

   printf(<B><FONT COLOR="#BC8F8F">&quot;aprox pi: &quot;</FONT></B>);
   mpf_out_str(NULL, 10, 20, p);
   printf(<B><FONT COLOR="#BC8F8F">&quot;\n&quot;</FONT></B>);

   <I><FONT COLOR="#B22222">/* Print out a few digits of the real thing */</FONT></I>
   mpf_set_str(p, <B><FONT COLOR="#BC8F8F">&quot;3.14159265358979323846264338327950288419716939937510582097494459230&quot;</FONT></B>, 10);
   printf(<B><FONT COLOR="#BC8F8F">&quot;real  pi: &quot;</FONT></B>);
   mpf_out_str(NULL, 10, 20, p);
   printf(<B><FONT COLOR="#BC8F8F">&quot;\n&quot;</FONT></B>);

   <B><FONT COLOR="#A020F0">return</FONT></B> 0;
} <I><FONT COLOR="#B22222">/* end func main */</FONT></I>
</PRE>
<HR \/>
<ADDRESS>Generated by <A HREF="http://www.iki.fi/~mtr/genscript/">GNU Enscript 1.6.5.2</A>.</ADDRESS>
</BODY>
</HTML>
