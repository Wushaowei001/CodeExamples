<!DOCTYPE html PUBLIC "-//IETF//DTD HTML 2.0//EN">
<HTML>
<HEAD>
<TITLE>ruby/dbiRuby.rb</TITLE>
</HEAD>
<BODY BGCOLOR="#FFFFFF" TEXT="#000000" LINK="#1F00FF" ALINK="#FF0000" VLINK="#9900DD">
<A NAME="top"> </A>
<A NAME="file1"> </A>
<H1><a href="dbiRuby.rb">dbiRuby.rb</a></H1>

<PRE>
<I><FONT COLOR="#B22222">#!/opt/local/bin/ruby
</FONT></I>
<I><FONT COLOR="#B22222">##
</FONT></I><I><FONT COLOR="#B22222"># @file      dbiRuby.rb
</FONT></I><I><FONT COLOR="#B22222"># @author    Mitch Richling &lt;http://www.mitchr.me/&gt;
</FONT></I><I><FONT COLOR="#B22222"># @Copyright Copyright 2007 by Mitch Richling.  All rights reserved.
</FONT></I><I><FONT COLOR="#B22222"># @brief     Using the Ruby DBI with Ruby-like constructs.@EOL
</FONT></I><I><FONT COLOR="#B22222"># @Keywords  ruby example database postgresql dbi
</FONT></I><I><FONT COLOR="#B22222"># @Std       Ruby 1.8
</FONT></I><I><FONT COLOR="#B22222">#
</FONT></I><I><FONT COLOR="#B22222">#            This example illustrates use of the DBI in a ruby-esq
</FONT></I><I><FONT COLOR="#B22222">#            way.  Notice how we avoid the .finish calls that are so
</FONT></I><I><FONT COLOR="#B22222">#            often a source of error with the Perl DBI -- see the
</FONT></I><I><FONT COLOR="#B22222">#            dbiPerl.rb example.
</FONT></I><I><FONT COLOR="#B22222">#
</FONT></I><I><FONT COLOR="#B22222">#            WARNING: This example requires that you have the DBI
</FONT></I><I><FONT COLOR="#B22222">#            module installed along with a driver for your database.
</FONT></I><I><FONT COLOR="#B22222">#            The code connects to a PostgreSQL DB named 'richmit' that
</FONT></I><I><FONT COLOR="#B22222">#            doesn't require a password.  Also note the first like is
</FONT></I><I><FONT COLOR="#B22222">#            /opt/local/bin/ruby, and not /usr/local/bin/ruby -- that
</FONT></I><I><FONT COLOR="#B22222">#            is because that is where I have a Ruby with the DBI
</FONT></I><I><FONT COLOR="#B22222">#            installed!  Surely this will require some modification
</FONT></I><I><FONT COLOR="#B22222">#            for your particular database setup.
</FONT></I>
<B><FONT COLOR="#5F9EA0">require</FONT></B> <B><FONT COLOR="#BC8F8F">'dbi'</FONT></B>
 
<I><FONT COLOR="#B22222"># Connect to the data base (PostgreSQL DB named &quot;richmit&quot; with no password).
</FONT></I>DBI.connect(<B><FONT COLOR="#BC8F8F">'DBI:pg:richmit'</FONT></B>) <B><FONT COLOR="#A020F0">do</FONT></B> | databaseHandle |

  <I><FONT COLOR="#B22222"># Create out table.
</FONT></I>  databaseHandle.<B><FONT COLOR="#A020F0">do</FONT></B>(<B><FONT COLOR="#BC8F8F">'create table foobar (foo varchar(16), bar numeric(10,2));'</FONT></B>)

  <I><FONT COLOR="#B22222"># Insert some records into our table.  Note the use of placeholders.
</FONT></I>  databaseHandle.prepare(<B><FONT COLOR="#BC8F8F">&quot;insert into foobar VALUES (?, ?)&quot;</FONT></B>) <B><FONT COLOR="#A020F0">do</FONT></B> | dbiStatementHandle |
    dbiStatementHandle.execute(<B><FONT COLOR="#BC8F8F">&quot;beep&quot;</FONT></B>, <B><FONT COLOR="#BC8F8F">&quot;1&quot;</FONT></B>)
    dbiStatementHandle.execute(<B><FONT COLOR="#BC8F8F">&quot;beepbeep&quot;</FONT></B>, <B><FONT COLOR="#BC8F8F">&quot;2&quot;</FONT></B>)
  <B><FONT COLOR="#A020F0">end</FONT></B>

  <I><FONT COLOR="#B22222"># Extract the records, and display them
</FONT></I>  databaseHandle.select_all(<B><FONT COLOR="#BC8F8F">'select * from foobar;'</FONT></B>) <B><FONT COLOR="#A020F0">do</FONT></B> | row |
    puts(row.inspect)
  <B><FONT COLOR="#A020F0">end</FONT></B>

  <I><FONT COLOR="#B22222"># Drop the table we created.
</FONT></I>  databaseHandle.<B><FONT COLOR="#A020F0">do</FONT></B>(<B><FONT COLOR="#BC8F8F">'drop table foobar;'</FONT></B>)
  
<B><FONT COLOR="#A020F0">end</FONT></B>
</PRE>
<HR \/>
<ADDRESS>Generated by <A HREF="http://www.iki.fi/~mtr/genscript/">GNU Enscript 1.6.5.2</A>.</ADDRESS>
</BODY>
</HTML>
