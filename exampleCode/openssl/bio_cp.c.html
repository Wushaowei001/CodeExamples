<!DOCTYPE html PUBLIC "-//IETF//DTD HTML 2.0//EN">
<HTML>
<HEAD>
<TITLE>openssl/bio_cp.c</TITLE>
</HEAD>
<BODY BGCOLOR="#FFFFFF" TEXT="#000000" LINK="#1F00FF" ALINK="#FF0000" VLINK="#9900DD">
<A NAME="top"> </A>
<A NAME="file1"> </A>
<H1><a href="bio_cp.c">bio_cp.c</a></H1>

<PRE>
<I><FONT COLOR="#B22222">/**
   @file      bio_cp.c
   @author    Mitch Richling &lt;http://www.mitchr.me/&gt;
   @Copyright Copyright 2008 by Mitch Richling.  All rights reserved.
   @brief     Demo basic BIO I/O with files.@EOL
   @Keywords  openssl bio
   @Std       C99

              The error checking in this program is not completely
              ideal, but it is typical of what one sees in the real
              world.  In particular, one should be more careful about
              interpreting values of 0, -1, and -2 from BIO_read and
              BIO_write.
*/</FONT></I>

#<B><FONT COLOR="#5F9EA0">include</FONT></B> <B><FONT COLOR="#BC8F8F">&lt;openssl/ssl.h&gt;</FONT></B>
#<B><FONT COLOR="#5F9EA0">include</FONT></B> <B><FONT COLOR="#BC8F8F">&lt;openssl/bio.h&gt;</FONT></B>

#<B><FONT COLOR="#5F9EA0">define</FONT></B> <FONT COLOR="#B8860B">BUFSIZE</FONT> 512

<B><FONT COLOR="#228B22">int</FONT></B> <B><FONT COLOR="#0000FF">main</FONT></B>(<B><FONT COLOR="#228B22">int</FONT></B> argc, <B><FONT COLOR="#228B22">char</FONT></B> *argv[]);

<B><FONT COLOR="#228B22">int</FONT></B> <B><FONT COLOR="#0000FF">main</FONT></B>(<B><FONT COLOR="#228B22">int</FONT></B> argc, <B><FONT COLOR="#228B22">char</FONT></B> *argv[]) {
  BIO *bio_stdin, *bio_stdout;
  <B><FONT COLOR="#228B22">char</FONT></B> buf[BUFSIZE];
  <B><FONT COLOR="#228B22">int</FONT></B> numBytesIn, numBytesOut;

  bio_stdin  = BIO_new_fp(stdin,  BIO_NOCLOSE);
  bio_stdout = BIO_new_fp(stdout, BIO_NOCLOSE);

  <B><FONT COLOR="#A020F0">if</FONT></B>(bio_stdin == NULL) {
    fprintf(stderr, <B><FONT COLOR="#BC8F8F">&quot;ERROR: stdin could not be attached to BIO!\n&quot;</FONT></B>);
    <B><FONT COLOR="#A020F0">return</FONT></B> 1;
  }
  <B><FONT COLOR="#A020F0">if</FONT></B>(bio_stdout == NULL) {
    fprintf(stderr, <B><FONT COLOR="#BC8F8F">&quot;ERROR: stdout could not be attached to BIO!\n&quot;</FONT></B>);
    <B><FONT COLOR="#A020F0">return</FONT></B> 2;
  }

  <B><FONT COLOR="#A020F0">while</FONT></B>((numBytesIn = BIO_read(bio_stdin, buf, BUFSIZE)) &gt; 0) {
    numBytesOut = BIO_write(bio_stdout, buf, numBytesIn);
    <B><FONT COLOR="#A020F0">if</FONT></B>(numBytesIn != numBytesOut)
      fprintf(stderr, <B><FONT COLOR="#BC8F8F">&quot;ERROR: Didn't write as many bytes (%d) as we got (%d)!\n&quot;</FONT></B>, numBytesIn, numBytesOut);
  } <I><FONT COLOR="#B22222">/* end while */</FONT></I>
  <B><FONT COLOR="#A020F0">if</FONT></B>(numBytesIn &lt; 0) 
    fprintf(stderr, <B><FONT COLOR="#BC8F8F">&quot;ERROR: Some sorta read error (BIO_read).  Return value: %d\n&quot;</FONT></B>, numBytesIn);

  <B><FONT COLOR="#A020F0">if</FONT></B>(BIO_free(bio_stdout) == 0)
    fprintf(stderr, <B><FONT COLOR="#BC8F8F">&quot;ERROR: Could not free bio_stdout!\n&quot;</FONT></B>);    
  <B><FONT COLOR="#A020F0">if</FONT></B>(BIO_free(bio_stdin) == 0)
    fprintf(stderr, <B><FONT COLOR="#BC8F8F">&quot;ERROR: Could not free bio_stdin!\n&quot;</FONT></B>);    

  <B><FONT COLOR="#A020F0">return</FONT></B> 0;
} <I><FONT COLOR="#B22222">/* end func main */</FONT></I>
</PRE>
<HR \/>
<ADDRESS>Generated by <A HREF="http://www.iki.fi/~mtr/genscript/">GNU Enscript 1.6.5.2</A>.</ADDRESS>
</BODY>
</HTML>
